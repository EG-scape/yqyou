/*!
 * @cloudbase/weda-cloud-sdk
 * Copyright© 2022 Tencent
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("mobx"),require("@cloudbase/js-sdk")):"function"==typeof define&&define.amd?define(["exports","mobx","@cloudbase/js-sdk"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CloudSDK={},e.mobx,e.cloudbase)}(this,(function(e,t,n){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=r(n),o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)};var s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function i(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))}function u(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}}var c=function(e){function t(t,n,r){var a=e.call(this,n)||this;return a.code=t,a.name="TCBError",a.original=r,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error);function l(e,t){return!!e&&Object.prototype.hasOwnProperty.call(e,t)}var f,d={},p={};function v(e){if(!f)throw new Error("app config not inited");return e?f[e]:f}function h(e){var t=m(e);if(t){if("database"===t.type){if(t.schema&&t.schema["x-viewId"])return t.schema["x-viewId"];console.warn("[weda-cloud-sdk]datasource",e,"is not database or viewId is empty")}}else console.warn("[weda-cloud-sdk]can not find datasource with options",e)}function m(e){if(f&&f.dataSourceProfiles&&f.dataSourceProfiles.length){var t="string"==typeof e?{val:e,key:"name"}:e,n="function"==typeof t?t:function(e){return e&&e[t.key]===t.val};return f.dataSourceProfiles.find(n)}console.warn("[weda-cloud-sdk]datasource profile is empty")}function g(e){f=Object.assign(f||{},e)}function w(e){return f.useLegacyDatasource?"lcap-".concat(e.id,"-").concat(e.name).concat(f.isProd?"":"-preview"):"lowcode-datasource".concat(f.isProd?"":"-preview")}function y(e){return!e&&f.useLegacyDatasource?"lcap-common-service":"lowcode-datasource".concat(f.isProd?"":"-preview")}function b(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}var O=[];function S(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=O.find((function(n){return n[0]===e&&b(n[1],t)}));if(r)return r[2];var a=e.apply(void 0,t);return O.push([e,t,a]),a}function T(e,t){if(!e)return e;return t.reduce((function(t,n){return l(e,n)&&(t[n]=e[n]),t}),{})}var I={};function D(e,t){I[e]=t}function N(e,t){var n=I[e];return n&&"function"==typeof n?n(t):n}function _(e){return function(t){D(e,t)}}var A={tempURLMaxWaitGap:50};function U(e){Object.assign(A,e)}function E(){return"undefined"!=typeof window&&window||"undefined"!=typeof globalThis&&globalThis}function L(){try{var e=E();if(!e)return;return"undefined"==typeof wx?E().location.href:e.__wxRoute}catch(e){}}function C(){var e,t=E();return(null==t?void 0:t.navigator)?t.navigator.userAgent:"undefined"!=typeof wx&&wx.getSystemInfo?(wx.getSystemInfo({success:function(t){t&&(e=["brand","model","version","system","platform","SDKVersion","language"].map((function(e){return"".concat(e,": ").concat(t[e])})).join(", "))}}),e):void 0}!function(){try{if(U({userAgent:C()}),"undefined"!=typeof window&&window&&window.top){var e=window.__wconfig||top.location.search,t={};if(/\b__wedaTarget=([^&]+)/.test(e)){var n=decodeURIComponent(RegExp.$1);n&&(t.wedaTarget=n)}/\b__useLegacy=true\b/.test(e)&&(t.useLegacyDatasource=!0),g(t)}}catch(e){}}();var P="1.0.8-alpha.12";function R(e){return i(this,void 0,void 0,(function(){var t,n,r,a,o,s,i;return u(this,(function(u){switch(u.label){case 0:(t=Object.assign({},e)).dataSourceName=t.name||t.dataSourceName,delete t.name,u.label=1;case 1:if(u.trys.push([1,3,,4]),(n=v("beforeDSRequest"))&&n(t),!(r=d[t.dataSourceName]))throw new Error("datasource ".concat(t.dataSourceName," not found"));if(!(a=r[t.methodName]))throw new Error("method ".concat(t.methodName," not found in datasource ").concat(t.dataSourceName," "));return[4,a(t.params,t.extraParams)];case 2:return o=u.sent(),(i=v("afterDSRequest"))&&i(t,null,o),[2,o];case 3:throw s=u.sent(),(i=v("afterDSRequest"))&&i(t,s),s;case 4:return[2]}}))}))}var F={get dataSources(){return g({parseBusinessInfo:!0}),d},get callDataSource(){return g({parseBusinessInfo:!0}),R},get callConnector(){return g({parseBusinessInfo:!0}),R},get callModel(){return g({parseBusinessInfo:!0}),R}};function k(e,t){return i(this,void 0,void 0,(function(){var n,r,a,o,s,i,l,f,d,p,h;return u(this,(function(u){switch(u.label){case 0:return n=Object.assign({},e),r=v("initTcb"),a=v("isProd"),o={wedaAppId:v("appID"),userAgent:A.userAgent,referrer:L(),envType:a?"prod":"pre",wedaTarget:v("wedaTarget"),"x-cloud-sdk-version":P},n.data=Object.assign({},e.data,o),(s=null==t?void 0:t.app)?[3,2]:[4,r()];case 1:i=u.sent(),s=i.app,u.label=2;case 2:return(l=v("beforeCallFunction"))?[4,l(n)]:[3,4];case 3:n=u.sent(),u.label=4;case 4:d=v("afterCallFunction"),u.label=5;case 5:return u.trys.push([5,7,,8]),[4,s.callFunction(n)];case 6:return f=u.sent(),d&&d(n,null,JSON.parse(JSON.stringify(f))),[3,8];case 7:throw p=u.sent(),d&&d(n,p),p;case 8:if(null==t?void 0:t.unwrapResult){if(h=f.result,!t.parseBusinessInfo)return[2,h];if(!h.code)return[2,h.data];throw console.warn("[weda-cloud-sdk]failed to call cloud function: ",h),new c(h.code,h.message,f)}return[2,f]}}))}))}function j(e,t){if("OPERATION_FAIL"===e.code||/OPERATION_FAIL/.test(e.message)){if(/FUNCTION_NOT_FOUND/.test(e.message)){var n=(null==t?void 0:t.FUNCTION_NOT_FOUND)||"找不到数据源的云函数";throw new c("FUNCTION_NOT_FOUND",n)}if(/FUNCTIONS_EXECUTE_FAIL/.test(e.message)){n=(null==t?void 0:t.FUNCTIONS_EXECUTE_FAIL)||"云函数执行失败";throw new c("FUNCTIONS_EXECUTE_FAIL",n)}}if(/network request error/.test(e.message))throw new c("NETWORK_ERROR","网络故障, 请检查本地网络连接是否正常");if(/method .* not found in datasource/i.test(e.message)){n=(null==t?void 0:t.DS_METHOD_NOT_FOUND)||"找不到数据源的方法";throw new c("DS_METHOD_NOT_FOUND",n)}if(null==t?void 0:t.DEFAULT_ERROR)throw new c(e.code||"DEFAULT_ERROR",t.DEFAULT_ERROR);throw e}function x(e,t){return i(this,void 0,void 0,(function(){return u(this,(function(n){return[2,k({name:y(),data:s(s({},e),{mode:"c"})},{app:t,unwrapResult:!0,parseBusinessInfo:!0}).catch((function(e){j(e,{FUNCTION_NOT_FOUND:"微搭环境异常: 未找到数据源公共云函数",FUNCTIONS_EXECUTE_FAIL:"微搭环境异常: 数据源公共云函数调用失败"})}))]}))}))}function M(e){return i(this,void 0,void 0,(function(){return u(this,(function(t){return[2,x({methodName:"callWedaApi",params:e}).then((function(e){return e.Data}))]}))}))}var $={wrapperDatasourceMethod:function(e){return function(t){return F.callDataSource({name:e.dataSourceName,methodName:e.methodName,params:t})}}},B={},q=[],V=[],W=[];var H=0,X=0;function G(){return i(this,void 0,void 0,(function(){var e,t,n,r,a;return u(this,(function(o){switch(o.label){case 0:e=V.splice(0),q=q.concat(e),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,v("initTcb")()];case 2:return[4,o.sent().app.getTempFileURL({fileList:e})];case 3:return t=o.sent(),q=q.filter((function(t){return!e.includes(t)})),t.code&&"SUCCESS"!==t.code||!Array.isArray(t.fileList)?(console.warn("[cloud.getTempFileURL]server response error",t),K({},e),[2]):(n={},r=[],t.fileList.forEach((function(e){var t;(l(t=e,"code")?"SUCCESS"===t.code:l(t,"status")&&!t.status)?n[e.fileID]=e.tempFileURL:(console.warn("[cloud.getTempFileURL]single item failed",e),r.push(e.fileID))})),K(n,r),[3,5]);case 4:return a=o.sent(),q=q.filter((function(t){return!e.includes(t)})),console.warn("[cloud.getTempFileURL] request failed",a),K({},e),[3,5];case 5:return[2]}}))}))}function K(e,t){Object.assign(B,e),W.forEach((function(e){var n=J(e.fileIds,t);!1!==n&&(e.resolve(n),e.isDone=!0)})),W=W.filter((function(e){return!e.isDone}))}function J(e,t){void 0===t&&(t=[]);try{if(Array.isArray(e)){return e.reduce((function(e,n){var r=B[n];if(!r){if(t.includes(n))return e;throw new Error("not found")}return e[n]=r,e}),{})}var n=B[e];if(!n){if(t.includes(e))return;throw new Error("not found")}return n}catch(e){return!1}}var Y=Object.assign(F,{IS_WEDA_IDE:!1,version:P,utils:$,getCloudInstance:function(){return i(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return[4,v("initTcb")()];case 1:return[2,e.sent().app]}}))}))},callGraphql:function(e){return i(this,void 0,void 0,(function(){var t,n,r,a;return u(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),(t=v("beforeDSRequest"))&&t(e),[4,k({name:y(!0),data:{mode:"graphql",params:e}},{unwrapResult:!0})];case 1:return n=o.sent(),(a=v("afterDSRequest"))&&a(e,null,n),[2,n];case 2:throw r=o.sent(),(a=v("afterDSRequest"))&&a(e,r),r;case 3:return[2]}}))}))},callFunction:k,callWorkflow:function(e){return i(this,void 0,void 0,(function(){return u(this,(function(t){return[2,M(e)]}))}))},callWedaApi:M,callCommonService:x,getTempFileURL:function(e){var t=function(e){var t=e&&"object"==typeof e&&e.fileList?e.fileList:e;return"string"==typeof t||Array.isArray(t)?t:void 0}(e);if(!t||!t.length)return Promise.resolve();var n=J(t);return!1!==n?Promise.resolve(n):new Promise((function(e,n){!function(e,t,n){W.push({fileIds:e,resolve:t,reject:n});var r=Array.isArray(e)?e:[e];V.length&&(r=r.filter((function(e){return!V.includes(e)})));r.length&&q.length&&(r=r.filter((function(e){return!q.includes(e)})));r.length&&(r=r.filter((function(e){return!B[e]})));if(!r.length)return;V=V.concat(r),clearTimeout(X);var a=Date.now();H=!H||a>H?a+A.tempURLMaxWaitGap:H,X=setTimeout(G,H-a)}(t,e,n)}))},getDataSourceViewId:h,getDataSourceProfile:m,setConfig:U,checkAuth:function(e){return M({action:"DescribeWedaAccessResourcesByType",data:e})},setDataSourceDefaultParams:D});var Z=["getItem","getList","delete","update","create","getRecords"];function z(e){var t,n=[];if("database"===e.type&&Array.isArray(null===(t=e.schema)||void 0===t?void 0:t["x-defaultMethods"])){var r=e.schema["x-defaultMethods"].map((function(e){return e.replace(/^weda([A-Z])/,(function(e,t){return t.toLowerCase()}))}));-1===r.indexOf("getRecords")&&r.push("getRecords");var a=r.map((function(e){return"weda".concat(e.charAt(0).toUpperCase()).concat(e.slice(1))}));n=r.filter((function(e){return Z.includes(e)})).concat(a)}e.methods&&n.push.apply(n,e.methods.map((function(e){return e.name})));var o={$setDefaultParams:_(e.name)};return n.reduce((function(t,n){return t[n]=function(e,t){return function(n,r){return i(this,void 0,void 0,(function(){var a,o,s,i;return u(this,(function(u){switch(u.label){case 0:(a=v("parseBusinessInfo"))&&g({parseBusinessInfo:!1}),o=w(e),u.label=1;case 1:return u.trys.push([1,3,,4]),s={params:n,methodName:t},[4,k({name:o,data:Object.assign(r||{},{dataSourceName:e.name,viewId:h({key:"name",val:e.name}),methodName:t,defaultParams:N(e.name,s),params:n})},{unwrapResult:!0,parseBusinessInfo:a})];case 2:return[2,u.sent()];case 3:return i=u.sent(),console.warn("[weda-cloud-sdk] failed to invoke datasource ".concat(e.name,"'s method ").concat(t),i),a&&j(i,{FUNCTION_NOT_FOUND:"找不到数据源".concat(e.name,"(").concat(e.id,")的云函数"),DS_METHOD_NOT_FOUND:"数据源".concat(e.name,"(").concat(e.id,")中的方法").concat(t,"不存在或者未启用"),FUNCTIONS_EXECUTE_FAIL:"调用数据源".concat(e.name,"(").concat(e.id,")方法").concat(t,"失败: 请检查该数据源所有自定义方法的代码中是否存在语法错误"),DEFAULT_ERROR:"调用数据源".concat(e.name,"(").concat(e.id,")方法").concat(t,"失败: ").concat(i.errMsg||i.message)}),[2,{code:i.errCode||-2,message:"调用数据源".concat(e.name,"(").concat(e.id,")方法").concat(t,"失败: ").concat(i.errMsg||i.message)}];case 4:return[2]}}))}))}}(e,n),t}),o)}var Q={get $call(){return g({parseBusinessInfo:!1}),R}};function ee(){Object.keys(d).forEach((function(e){Object.defineProperty(Q,e,{get:function(){return g({parseBusinessInfo:!1}),d[e]},configurable:!0,enumerable:!0})}))}function te(e,t){var n=e.split(".");if(2===n.length){var r=n[0];if("$page"===r){var a=v("currentPageId");if(!a||"$global"===a)return void console.warn("[weda-cloud-sdk]setStateVar: can not find currentPageId",r);r=a}var o=p[r],s=n[1];if(o&&(l(o.state.$status,s)||l(o.state,s))){if(o.state.$status[s]){if(t instanceof Error)return void(o.state.$status[s]={status:"failed",code:t.code||-1,message:t.message,error:t});"success"!==o.state.$status[s].status&&(o.state.$status[s]={status:"success"})}o.state[s]=t}}else console.warn("[weda-cloud-sdk]setStateVar: invalid varPath",e)}ee();var ne={setState:te,setParams:function(e,t){var n=(v("datasetProfiles")||{})[e],r=p[e];r&&n&&n.params&&(r.params=T(t,Object.keys(n.params)))}};function re(e,t){if(e){var n=Object.keys(e);if(!n.length)return{};return n.reduce((function(n,r){if(n[r]="",t){var a=e[r];n[r]=a.sampleValue||""}return n}),{})}}function ae(e){if(!e)return{};return Object.keys(e).reduce((function(t,n){var r=e[n];return"state"!==r.varType||(t[n]=r.initialValue),t}),{})}function oe(e){var t=e.dataSourceProfiles;if(g(e),t){var n=v("customCreateDataSources");if(n)return n(t),void Object.assign(Q,d);t.reduce((function(e,t){return e[t.name]=z(t),e}),d),ee()}}function se(){return i(this,void 0,void 0,(function(){var e,t,n,r,o;return u(this,(function(s){return e=v(),(null==(t=window._WedaHostConfig)?void 0:t.tcbInstance)?n=t.tcbInstance:(n=a.default.init({timeout:6e4,env:e.envID,clientId:e.tcbClientId}),e.isPrivate&&(r="//".concat(window.location.hostname,"/web"),a.default.registerEndPoint(r,window.location.protocol))),o=n.auth({persistence:"local"}),[2,{app:n,auth:o}]}))}))}function ie(){return S(se)}function ue(){return i(this,void 0,void 0,(function(){var e,t,n,r,a,o,s,i;return u(this,(function(u){switch(u.label){case 0:return[4,ie()];case 1:if(!(e=u.sent().auth).loginScope)return[3,9];u.label=2;case 2:return u.trys.push([2,8,,9]),t=!0,e.hasLoginState()&&(t=!1),[4,e.loginScope()];case 3:n=u.sent(),r="anonymous"===n,a=void 0,u.label=4;case 4:return u.trys.push([4,6,,7]),[4,e.loginGroups()];case 5:return a=u.sent(),[3,7];case 6:return o=u.sent(),console.warn("[weda-cloud-sdk] loginGroups faile",o),[3,7];case 7:return[2,{notLogin:t,isAnonymous:r,hasLogin:!t&&!r,groups:a}];case 8:return s=u.sent(),console.warn("[weda-cloud-sdk] getLoginState faile",s),[2,{notLogin:!0,isAnonymous:!1,hasLogin:!1}];case 9:return e.hasLoginState?[2,{notLogin:!(i=e.hasLoginState()),isAnonymous:!!i&&"ANONYMOUS"===i.loginType,hasLogin:!!i&&"ANONYMOUS"!==i.loginType,version:"1.0"}]:(console.warn("[weda-cloud-sdk] unable to get loginState due to unsupported @cloudbase/js-sdk version, please update to latest version."),[2,{notLogin:!1,isAnonymous:!0,hasLogin:!1,version:"1.0"}])}}))}))}var ce=null;function le(e){return i(this,void 0,void 0,(function(){var t;return u(this,(function(n){switch(n.label){case 0:return[4,ie()];case 1:return t=n.sent().app,[4,x({methodName:"signIn",params:e||{}},t)];case 2:return[2,ce=n.sent()]}}))}))}function fe(){return i(this,void 0,void 0,(function(){var e;return u(this,(function(t){switch(t.label){case 0:return[4,ie()];case 1:return(e=t.sent().auth).anonymousAuthProvider?[4,e.anonymousAuthProvider().signIn()]:[3,3];case 2:return t.sent(),[3,6];case 3:return e.signInAnonymously?[4,e.signInAnonymously()]:[3,5];case 4:return t.sent(),[3,6];case 5:console.warn("[weda-cloud-sdk] failed to anonymous login, unsupported @cloudbase/js-sdk version"),t.label=6;case 6:return[2]}}))}))}var de={signIn:le,getUserInfo:function(){return i(this,void 0,void 0,(function(){return u(this,(function(e){switch(e.label){case 0:return ce?[3,3]:[4,ie()];case 1:return[4,x({methodName:"getUserInfo",params:{}},e.sent().app)];case 2:ce=e.sent(),e.label=3;case 3:return[2,ce]}}))}))},signOut:function(){return i(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return[4,ue()];case 1:return e=n.sent(),[4,ie()];case 2:return t=n.sent().auth,ce=null,e.hasLogin&&t.signOut(),e.isAnonymous?[3,5]:[4,fe()];case 3:return n.sent(),[4,le({userType:"anonymousUser"})];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))},anonymousLogin:fe,get currentUser(){var e;if(ce)return Object.assign({},ce);var t,n=null===(e=window._WedaHostConfig)||void 0===e?void 0:e.wedaUser;return n?s(s({},t=n),{wedaId:t.userId||"",avatarUrl:t.avatar,nickName:t.name||"",gender:0}):null}},pe=Object.assign(Y,de);function ve(){var e,t;return i(this,void 0,void 0,(function(){var n,r,a,o,s,i,c;return u(this,(function(u){switch(u.label){case 0:return[4,ie()];case 1:return n=u.sent(),r=n.app,a=n.auth,o=window._WedaHostConfig,[4,ue()];case 2:return s=u.sent(),i=!s.hasLogin,!(null==o?void 0:o.login)||s.hasLogin?[3,4]:[4,o.login()];case 3:return u.sent(),i=!1,[3,6];case 4:return s.notLogin?[4,de.anonymousLogin()]:[3,6];case 5:u.sent(),i=!0,u.label=6;case 6:return o?(null===(e=null==o?void 0:o.wedaUser)||void 0===e?void 0:e.relatedRoles)?[3,8]:[4,de.getUserInfo()]:[3,9];case 7:u.sent(),u.label=8;case 8:return[3,11];case 9:return c=i?"anonymousUser":"1.0"===s.version||(null===(t=s.groups)||void 0===t?void 0:t.includes("internal"))?"internalUser":"externalUser",[4,de.signIn({userType:c})];case 10:u.sent(),u.label=11;case 11:return[2,{app:r,auth:a}]}}))}))}function he(){return i(this,void 0,void 0,(function(){return u(this,(function(e){return[2,S(ve)]}))}))}Object.defineProperty(pe,"currentUser",{get:function(){return de.currentUser}}),oe({initTcb:he}),e.CLOUD_API=Y,e.CLOUD_SDK=pe,e.DATASET_CONTEXT=p,e.DS_API=d,e.DS_SDK=Q,e.EXTRA_API=ne,e.TCBError=c,e._setConfig=g,e.callDataSource=R,e.createDataset=function(e,n){g({currentPageId:e});var r=(v("datasetProfiles")||{})[e],a=t.observable({state:{$status:{}},params:{}});if(p[e]=a,!r)return a;var o=re(r.params,n),s=ae(r.state);return Object.assign(a.params,o),Object.assign(a.state,s),a},e.createParamsVar=re,e.createSetDefaultParams=_,e.createStateDataSourceVar=function(e,t){var n,r;return i(this,void 0,void 0,(function(){var a,o,s,c=this;return u(this,(function(l){return a=null===(n=p[e])||void 0===n?void 0:n.state,o=v("datasetProfiles")||{},s=null===(r=o[e])||void 0===r?void 0:r.state,a&&s?(Object.keys(s).forEach((function(n){return i(c,void 0,void 0,(function(){var r,o,i,c;return u(this,(function(u){switch(u.label){case 0:if("datasource"!==(r=s[n]).varType)return[2];if(!r.initMethod||!r.initMethod.name)return a[n]={},a.$status[n]={status:"idle"},[2];u.label=1;case 1:return u.trys.push([1,3,,4]),a.$status[r.name]={status:"loading"},o=r.initMethod,[4,Y.callDataSource({name:r.dataSourceName,methodName:o.name,params:t(o.params,o),options:{showLoading:!0}})];case 2:return i=u.sent(),te("".concat(e,".").concat(r.name),i),[3,4];case 3:return c=u.sent(),console.error("[weda-cloud-sdk] failed to init ".concat(e,".").concat(r.name),c),te("".concat(e,".").concat(r.name),c),[3,4];case 4:return[2]}}))}))})),[2]):[2]}))}))},e.createStaticStateVar=ae,e.execOnce=S,e.generateParamsParser=function(e){return function(t){if(!t)return t;var n={};return Object.keys(t).forEach((function(r){n[r]=t[r](e.app,e.$page)})),n}},e.getAccessToken=function(){return i(this,void 0,void 0,(function(){var e,t;return u(this,(function(n){switch(n.label){case 0:return[4,ie()];case 1:return(e=n.sent().auth).getAccessToken?[2,e.getAccessToken()]:e.getAuthHeader?(t=e.getAuthHeader())?[2,Object.assign({},t,{accessToken:t["x-cloudbase-credentials"]})]:[2,t]:[2]}}))}))},e.getCommonCloudFnName=y,e.getConfig=v,e.getDataSourceProfile=m,e.getDataSourceViewId=h,e.getDatasourceCloudFnName=w,e.getDefaultParams=N,e.getTcbInstance=ie,e.hasOwn=l,e.initTcb=he,e.isSameArray=b,e.pick=T,e.setConfig=oe,e.setDefaultParams=D,Object.defineProperty(e,"__esModule",{value:!0})}));
